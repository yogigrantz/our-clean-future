@page "/indicators/edit/{id:int}"

@if (_isLoaded == false)
{
    @*<p><em>Loading...</em></p>*@
}
else
{
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16">
        <MudText Typo="Typo.h3" GutterBottom="true">Edit indicator</MudText>
        <MudAlert Icon="@Icons.Material.Filled.Lightbulb" Severity="Severity.Normal" Class="mb-6">
            If you need to modify a value within the dropdown menus, you can do that from the <b>Administration</b> menu on the lefthand navigation bar.
        </MudAlert>
        <EditForm Model="@_indicator" OnValidSubmit="Update">
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudPaper Elevation="2" Class="pa-4">
                        <MudSelect T="Data.Entities.Owner" Label="Lead" @bind-Value="_indicator.Owner">
                            @foreach (var owner in Owners)
                            {
                                @*<MudSelectItem Value="owner">@(owner.Branch?.Name ?? owner.Organization.Name)</MudSelectItem>*@
                                <MudSelectItem Value="owner">@owner.ToString()</MudSelectItem>
                            }
                        </MudSelect>
                        <MudTextField Label="Title" T="string" @bind-Value="_indicator.Title" />
                        <MudTextField Label="Description" T="string" @bind-Value="_indicator.Description" Lines="2" />
                        <MudSelect T="Data.Entities.UnitOfMeasurement" Label="Unit of Measurement" @bind-Value="_indicator.UnitOfMeasurement">
                            @foreach (var unit in UnitsOfMeasurement)
                            {
                                <MudSelectItem Value="unit">@unit.Symbol</MudSelectItem>
                            }
                        </MudSelect>
                        <MudTextField Label="Target" T="string" @bind-Value="_indicator.Target"></MudTextField>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudPaper Elevation="2" Class="pa-4">
                        <MudSelect T="Data.Entities.DataType" Label="Data Type" @bind-Value="_indicator.DataType">
                            <MudSelectItem Value="Data.Entities.DataType.Cumulative">Cumulative</MudSelectItem>
                            <MudSelectItem Value="Data.Entities.DataType.Incremental">Incremental</MudSelectItem>
                        </MudSelect>
                        <MudAutocomplete Label="Collection Interval" T="Data.Entities.CollectionInterval" SearchFunc="@SearchCollectionIntervals"
                                         CoerceText="true" SelectValueOnTab="true" ResetValueOnEmptyText="true" @bind-Value="_indicator.CollectionInterval">
                        </MudAutocomplete>
                        <MudItem Class="mb-16">
                            <MudSelect Label="OCF Reference" T="Data.Entities.OurCleanFutureReference" @bind-Value="_indicator.OurCleanFutureReference" DisableUnderLine="true">
                                @foreach (var reference in OurCleanFutureReferences)
                                {
                                    <MudSelectItem Value="reference">@reference.ReferenceText</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudPaper Elevation="2" Class="pa-4">
                        <MudSwitch @bind-Checked="@_indicator.IsActive" Color="Color.Info">@(_indicator.IsActive?"Active":"Inactive")</MudSwitch>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" Class="d-flex justify-space-between py-2 px-3 mt-2">
                    <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Secondary" Link="/indicators">Cancel</MudButton>
                    <MudButton ButtonType="ButtonType.Submit" Disabled="true" />
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Submit</MudButton>
                </MudItem>
            </MudGrid>
        </EditForm>
    </MudContainer>
}